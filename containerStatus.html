<!DOCTYPE html>
<html>
<head>
  <base href="/static/js/">
  <style>html { font-size: 14px; font-family: Arial, Helvetica, sans-serif; }</style>
  <title></title>
  <link rel="stylesheet" href="kendo-ui/styles/kendo.common-material.min.css" />
  <link rel="stylesheet" href="kendo-ui/styles/kendo.material.min.css" />
  <link rel="stylesheet" href="kendo-ui/styles/kendo.material.mobile.min.css" />

  <script src="kendo-ui/js/jquery.min.js"></script>
  <script src="kendo-ui/js/kendo.all.min.js"></script>

  <script src="translate.js/jquery.translate.js"></script>
  <script src="dictionary/dictionary.js"></script>

  <script>

    var translator;
    var globalConfig = {
      panelProtocol: "http",
      panelSubDomain: "panel.",
      panelHost: "localhost:8888",
      language: "pt_Br"
    };

    var golbalOnInit = [];
  </script>
  <script src="mvc/model/imageList/imageList.js"></script>


  <script src="mvc/model/exposedPorts/exposedPorts.js"></script>
  <!-- Exposed ports template - início -->
  <script id="containerHostExposedPortsFooterTemplate" type="text/x-kendo-tmpl">
    <button class="k-button k-primary centerText" onclick="containerHostExposedPortsAddNewPort()">Add new port and protocol</button>
  </script>
  <script id="containerHostExposedPortsTemplate" type="text/x-kendo-tmpl">
    <span>Port: #= Value #<br>Usually used in: #= ImageName #</span>
  </script>
  <script id="containerHostExposedPortsNoDataTemplate" type="text/x-kendo-tmpl">
    <div>
      No ports found to add. Please add a port and a protocol before continuing.
    </div>
  </script>
  <script type="text/x-kendo-template" id="containerCreateTemplateExposedPortsAddNewPort">
    <span>
      <input type="text" id="ExposedPortsNumber" name="ExposedPorts" class="oneThirdSize" placeholder="" required validationMessage="Enter a {0}" autocomplete="off" />
      <select id="ExposedPortsProtocol" class="oneThirdSize" autocomplete="off" >
        <option>TCP</option>
        <option>UDP</option>
      </select>
    </span>
  </script>
  <!-- Exposed ports template - fim -->

  <script src="mvc/model/envVar/envVar.js"></script>
  <script id="containerHostEnvFooterTemplate" type="text/x-kendo-tmpl">
    <button class="k-button k-primary centerText" onclick="containerHostEnvVarAddNewEnvVar()">Add new enviromment var</button>
  </script>
  <script id="containerHostEnvTemplate" type="text/x-kendo-tmpl">
    <span>Environment var: #= EnvVar #</span>
  </script>
  <script id="containerHostEnvNoDataTemplate" type="text/x-kendo-tmpl">
    <div>
      No environments vars found to add. Please add an environment var before continuing.
    </div>
  </script>
  <script type="text/x-kendo-template" id="containerCreateTemplateEnvVarAddNewEnvVar">
    <span>
      <input type="text" id="EnvVarName" name="env" class="k-textbox envVarSize" placeholder="" required validationMessage="Enter a {0}" autocomplete="off" />
    </span>
  </script>










  <script src="mvc/model/entryPoint/entryPoint.js"></script>
  <script id="containerHostEntryPointFooterTemplate" type="text/x-kendo-tmpl">
    <button class="k-button k-primary centerText" onclick="containerHostEntryPointAddNewEntryPoint()">Add new entry point</button>
  </script>
  <script id="containerHostEntryPointTemplate" type="text/x-kendo-tmpl">
    <span>Entry point: #= EntryPoint #</span>
  </script>
  <script id="containerHostEntryPointNoDataTemplate" type="text/x-kendo-tmpl">
    <div>
      No entry point commands found to add. Please add an entry point command before continuing.
    </div>
  </script>
  <script type="text/x-kendo-template" id="containerCreateTemplateEntryPointAddNewEntryPoint">
    <span>
      <input type="text" id="EntryPointName" name="EntryPoint" class="k-textbox envVarSize" placeholder="" required validationMessage="Enter a {0}" autocomplete="off" />
    </span>
  </script>











  <script src="mvc/model/onBuild/onBuild.js"></script>
  <script id="containerHostOnBuildFooterTemplate" type="text/x-kendo-tmpl">
    <button class="k-button k-primary centerText" onclick="containerHostOnBuildAddNewOnBuild()">Add new on build meta data</button>
  </script>
  <script id="containerHostOnBuildTemplate" type="text/x-kendo-tmpl">
    <span>On Build: #= OnBuild #</span>
  </script>
  <script id="containerHostOnBuildNoDataTemplate" type="text/x-kendo-tmpl">
    <div>
      No on build metadata found to add. Please add an on build metadata before continuing.
    </div>
  </script>
  <script type="text/x-kendo-template" id="containerCreateTemplateOnBuildAddNewOnBuild">
    <span>
      <input type="text" id="OnBuildName" name="OnBuild" class="k-textbox envVarSize" placeholder="" required validationMessage="Enter a {0}" autocomplete="off" />
    </span>
  </script>








  <script src="mvc/model/labels/labels.js"></script>
  <script id="containerHostLabelsFooterTemplate" type="text/x-kendo-tmpl">
    <button class="k-button k-primary centerText" onclick="containerHostLabelsAddNewLabels()">Add new labels</button>
  </script>
  <script id="containerHostLabelsTemplate" type="text/x-kendo-tmpl">
    <span>Label: #= Labels #</span>
  </script>
  <script id="containerHostLabelsNoDataTemplate" type="text/x-kendo-tmpl">
    <div>
      No labels found to add. Please add an labels before continuing.
    </div>
  </script>
  <script type="text/x-kendo-template" id="containerCreateTemplateLabelsAddNewLabels">
    <span>
      <input type="text" id="LabelsKey" name="LabelsKey" class="k-textbox oneThirdSize" placeholder="Key" required validationMessage="Enter a {0}" autocomplete="off" />
      <input type="text" id="LabelsName" name="LabelsName" class="k-textbox oneThirdSize" placeholder="Value" required validationMessage="Enter a {0}" autocomplete="off"
    </span>
  </script>












  <script src="mvc/model/createContainer/createContainer.js"></script>

  <style>

    .centerText {
      text-align: center;
      width: 100%;
    }

    /* Success template - start */
    .k-notification-success {
      background: rgba(0%,60%,0%,.7);
      color: #fff;
    }
    .success {
      width: 280px;
      height: 80px;
      padding: 0 30px;
      line-height: 55px;
    }
    .success h3 {
      font-size: 1em;
      font-weight: normal;
      display: inline-block;
      vertical-align: middle;
    }
    .success img {
      display: inline-block;
      vertical-align: middle;
      margin-right: 10px;
    }
    /* Success template - end */

    .containerLog{
      max-height: 300px;
      overflow: auto;
    }



    .containerData {
      border-collapse: collapse;
      width: 100%;
    }
    .k-window-content h2 {
      margin-bottom: 2px;
      margin-top: 5px;
    }
    .k-window-content em {
      font-size: 10px;
    }
    .containerData td {
      padding: 0;
      vertical-align: bottom;
      height: 30px;

      font-size: 1.0em;
      font-weight: normal;
      line-height: 20px;
    }
    .containerData td.col1 {
      width: 90px;
    }
    .containerData td.col2 {
      width: 508px;
    }
    .containerData td.col3 {
      width: 60px;
    }
    .containerData th, td {
      border-bottom: 1px solid #eee;
    }
    .containerData td.value span {
      font-size: .5em;
      vertical-align: top;
      line-height: 30px;
    }

    .bug {
      font-size: 10px;
      color: #ff0000;
    }












    #fieldlist {
      margin: 0;
      padding: 0;
    }

    #fieldlist label .k-numerictextbox {
      font-size: 14px;
    }

    #fieldlist li {
      list-style: none;
      padding-bottom: .7em;
      text-align: left;
    }

    #fieldlist label {
      display: block;
      padding-top: 1em;
      padding-bottom: .3em;
      font-weight: bold;
      text-transform: uppercase;
      font-size: 12px;
      color: #444;
    }

    #fieldlist span.status {
      text-align: center;
    }

    #fieldlist span .k-widget:not(.k-tooltip),
    #fieldlist span .k-textbox {
      margin: 0 5px 5px 0;
    }

    #fieldlist span input[type="checkbox"] {
      margin: 0 5px 0 0;
    }

    .k-combobox {
      width: 624px;
    }

    .k-combobox input[type="text"] {
      width: 622px !important;
    }

    #fieldlist span input[type="text"] {
      width: 624px;
    }

    #ExposedPortsNumber span input[type="text"] {
      width: 624px;
    }

    /* numeric text box - inicio */
    .oneThirdSize span input[type="text"] .k-autocomplete, .k-numerictextbox {
      width: 227px !important;
    }

    .envVarSize {
      width: 427px !important;
    }

    .oneThirdSize span input[type="text"] .k-formatted-value, .oneThirdSize, .k-input {
      width: 224px !important;
    }
    /* numeric text box - fim */

    #fieldlist .k-textbox {
      border-color: #cccccc;
    }

    .confirm {
      padding-top: 1em;
    }

    .valid {
      color: green;
    }

    .invalid {
      color: red;
    }

    /*#fieldlist li input[type="checkbox"] {
      margin: 0 5px 0 0;
    }*/

    span.k-widget.k-tooltip-validation {
      display: inline-block;
      width: 160px;
      text-align: left;
      border: 0;
      padding: 0;
      margin: 0;
      background: none;
      box-shadow: none;
      color: red;
    }



    .k-dropdown-wrap.k-state-default {
      border-color: #cccccc;
    }

    .k-tooltip-validation .k-warning {
      display: none;
    }
  </style>
</head>
<body>
<div>
  <!-- código apenas para teste - inicio -->
  <a id="createAContainerIconTextButton" data-trn-key="Create a container" class="k-button trn">Create a container</a><br><br>
  <!-- código apenas para teste - fim -->

  <!-- Monta o grid onde são mostrados todos os conteines, ativos e inativos do sistema - inicio -->
  <div id="containerListAndDetailsGridView"></div>
  <!-- Monta o grid onde são mostrados todos os conteines, ativos e inativos do sistema - fim -->

  <!-- Mostra os detalhes do container - inicio -->
  <div id="containerDetailsWindowView"></div>
  <!-- Mostra os detalhes do container - fim -->

  <div id="containerHostExposedPortsAddNewPort"></div>
  <div id="containerHostEnvAddNewEnvVar"></div>
  <div id="containerHostEntryPointAddNewEntryPoint"></div>
  <div id="containerHostOnBuildAddNewOnBuild"></div>
  <div id="containerHostLabelsAddNewLabels"></div>




  <!-- Conteúdo da janela que adiciona container - inicio -->
  <div id="windowCreateContainer" class="k-content">
    <form id="ticketsForm">
      <ul id="containerCreatePanelBarContent">
        <!-------------------------------- Basic -------------------------------------------->
        <li class="k-state-active">
          <span class="k-link k-state-selected" data-trn-key="Basic configuration">Basic configuration</span>
          <div>
            <ul id="fieldlist">
              <span>
                <label for="name" class="required" title="Container name" data-trn-key="Container Name">Container Name</label>
                <input type="text" id="containerConfigurationName" name="name" class="k-textbox" placeholder="" required validationMessage="Enter a {0}" autocomplete="off" />
              </span>
                <span>
                <label for="image" class="required" title="Name of the image as it was passed by the operator (e.g. could be symbolic)" data-trn-key="Image">Image</label>
                <input type="text" id="containerConfigurationImageName" name="image" placeholder="" required validationMessage="Enter a {0}" autocomplete="off" />
              </span>
                <span>
                <label for="WaitForErrors" title="Waits for error messages before releasing the container creation process" data-trn-key="Wait for errors">Wait for errors</label>
                <input type="checkbox" id="containerConfigurationWaitForErrors" name="waitforerrors" checked="checked" />
              </span>
                <span>
                <label for="ExposedPorts" title="List of exposed ports from container" data-trn-key="Container Exposed Ports And Protocol">Container Exposed Ports And Protocol</label>
                <select id="containerHostExposedPorts" name="ExposedPorts" autocomplete="off"></select>
              </span>
              <span>
                <label for="env" title="List of environment variable to set in the container" data-trn-key="Environment Variable">Environment Variable</label>
                <select id="containerHostEnv" name="env" autocomplete="off"></select>
              </span>
            </ul>
          </div>
        </li>
        <!-------------------------------- Advanced -------------------------------------------->
        <li>
          <span class="k-link k-state-selected" data-trn-key="Advanced">Advanced</span>
          <div style="padding: 10px;">
            <ul id="fieldlist">
              <span>
                <label for="hostname" title="Host name" data-trn-key="Host name">Host name</label>
                <input type="text" id="hostname" name="hostname" class="k-textbox" placeholder="" validationMessage="Enter a {0}" autocomplete="off" />
              </span>
                <span>
                <label for="domainname" title="Domain name" data-trn-key="Domain name">Domain name</label>
                <input type="text" id="domainname" name="domainname" class="k-textbox" placeholder="" validationMessage="Enter a {0}"  autocomplete="off"/>
              </span>
                <span>
                <label for="user" title="User that will run the command(s) inside the container, also support user:group" data-trn-key="User">User</label>
                <input type="text" id="user" name="user" class="k-textbox" placeholder="user or user:group" validationMessage="Enter a {0}"  autocomplete="off"/>
              </span>
                <span>
                <label for="attachStdin" title="Attach the standard input, makes possible user interaction" data-trn-key="Attach std in">Attach std in</label>
                <input type="checkbox" id="attachStdin" name="attachStdin" checked="checked" />
              </span>
                <span>
                <label for="attachStdout" title="Attach the standard output, makes possible user interaction" data-trn-key="Attach std out">Attach std out</label>
                <input type="checkbox" id="attachStdout" name="attachStdout" checked="checked" />
              </span>
                <span>
                <label for="attachStderr" title="Attach the standard error, makes possible user interaction" data-trn-key="Attach std error">Attach std error</label>
                <input type="checkbox" id="attachStderr" name="attachStderr" checked="checked" />
              </span>
                <span>
                <label for="try" title="Attach standard streams to a tty, including stdin if it is not closed." data-trn-key="Try">Try</label>
                <input type="checkbox" id="try" name="try" checked="checked" />
              </span>
                <span>
                <label for="openStdin" title="Open standard in" data-trn-key="Open standard in">Open standard in</label>
                <input type="checkbox" id="openStdin" name="openStdin" checked="checked" />
              </span>
                <span>
                <label for="stdinOnce" title="If true, close stdin after the 1 attached client disconnects." data-trn-key="Std in once">Std in once</label>
                <input type="checkbox" id="stdinOnce" name="stdinOnce" />
              </span>

              <!-- Healthcheck próxima versão -->

              <span>
                <label for="argsEscaped" title="True if command is already escaped (Windows specific)" data-trn-key="Args Escaped">Args Escaped</label>
                <input type="checkbox" id="argsEscaped" name="argsEscaped" />
              </span>
              <span>
                <label for="workingrir" title="Name of the image as it was passed by the operator (e.g. could be symbolic)" data-trn-key="Working dir">Working dir</label>
                <input type="text" id="workingrir" name="workingrir" class="k-textbox" placeholder="" validationMessage="Enter a {0}" autocomplete="off" />
              </span>
              <span>
                <label for="EntryPoint" title="Entrypoint to run when starting the container" data-trn-key="Entry Point">Entry Point</label>
                <select id="containerHostEntryPoint" name="EntryPoint" autocomplete="off"></select>
              </span>
              <span>
                <label for="networkdisabled" title="Is network disabled" data-trn-key="Network Disabled">Network Disabled</label>
                <input type="checkbox" id="networkdisabled" name="networkdisabled" />
              </span>
                <span>
                <label for="macaddress" title="Mac Address of the container" data-trn-key="Mac Address of the container">Mac Address of the container</label>
                <input type="text" id="macaddress" name="macaddress" class="k-textbox" placeholder="" validationMessage="Enter a {0}" autocomplete="off" />
              </span>



              <!-- OnBuild -->
              <span>
                <label for="OnBuild" title="on build metadata that were defined on the image Dockerfile" data-trn-key="On Build">On Build</label>
                <select id="containerHostOnBuild" name="OnBuild" autocomplete="off"></select>
              </span>




              <!-- Labels -->
              <span>
                <label for="Labels" title="List of labels set to this container" data-trn-key="Labels">Labels</label>
                <select id="containerHostLabels" name="Labels" autocomplete="off"></select>
              </span>







              <span>
                <label for="stopsignal" title="Signal to stop a container" data-trn-key="Stop Signal">Stop Signal</label>
                <input type="text" id="stopsignal" name="stopsignal" class="k-textbox" placeholder="" validationMessage="Enter a {0}" autocomplete="off" />
              </span>
              <span><!-- deve ser numerico -->
                <label for="stoptimeout" title="Timeout (in seconds) to stop a container" data-trn-key="Stop Timeout">Stop Timeout</label>
                <input id="stoptimeout" name="stoptimeout" type="text" min="0" value="0" data-max-msg="Enter value between 0 and 1000" class="k-textbox" placeholder="" autocomplete="off" />
                <span class="k-invalid-msg" data-for="stoptimeout"></span>
              </span>

              <!-- shell -->

            </ul>
          </div>
        </li>
        <li>
          Projects
          <ul>
            <li>New Business Plan</li>
            <li>
              Sales Forecasts
              <ul>
                <li>Q1 Forecast</li>
                <li>Q2 Forecast</li>
                <li>Q3 Forecast</li>
                <li>Q4 Forecast</li>
              </ul>
            </li>
            <li>Sales Reports</li>
          </ul>

        </li>
        <li>
          Programs
          <ul>
            <li>Monday</li>
            <li>Tuesday</li>
            <li>Wednesday</li>
            <li>Thursday</li>
            <li>Friday</li>
          </ul>
        </li>
        <li disabled="disabled">
          Communication
        </li>
      </ul>













    </form>
  </div>
  <!-- Conteúdo da janela que adiciona container - fim -->

  <script>



    var windowContainerDetails, detailsTemplate;
    var lastContainerStatusOldValue = {};
    var containerStatisticsSetIntervalId;
    var containerStatisticsWaitingData = false;
    var containerStatisticMemPercentData = [];
    var containerStatisticCpuPercentData = [];
    var containerStatisticBlkReadData = [];
    var containerStatisticBlkWriteData = [];
    var containerStatisticNetRxData = [];
    var containerStatisticNetTxData = [];
    var containerStatisticPidsStatsCurrentData = [];


    var containerConfigurationNameRef;

    var containerConfigurationWaitForErrorsRef;


    /*var containerConfiguration
    var containerConfiguration
    var containerConfiguration
    var containerConfiguration
    var containerConfiguration
    var containerConfiguration
    var containerConfiguration
    var containerConfiguration*/





    $(document).ready(function() {

      // Traduz o conteúdo do sistema
      // Deve ficar antes do kendo inicializar
      translator = $("body").translate({lang: globalConfig.language, t: dict["CreateAContainer"]});
      //translator.lang(globalConfig.language);



      for( var i in golbalOnInit ){
        i = parseInt( i );
        if( typeof golbalOnInit[ i ] === "function" ){
          golbalOnInit[ i ]();
        }
      }







      containerConfigurationNameRef = $("#containerConfigurationName");





      $("#stoptimeout").kendoNumericTextBox();




      $("#containerConfigurationWaitForErrors").kendoMobileSwitch({ onLabel: translator.get("On"), offLabel: translator.get("Off") });

      containerConfigurationWaitForErrorsRef = $("#containerConfigurationWaitForErrors").data("kendoMobileSwitch");


      $("#attachStdin").kendoMobileSwitch({ onLabel: translator.get("On"), offLabel: translator.get("Off") });
      $("#attachStdout").kendoMobileSwitch({ onLabel: translator.get("On"), offLabel: translator.get("Off") });
      $("#attachStderr").kendoMobileSwitch({ onLabel: translator.get("On"), offLabel: translator.get("Off") });
      $("#try").kendoMobileSwitch({ onLabel: translator.get("On"), offLabel: translator.get("Off") });
      $("#openStdin").kendoMobileSwitch({ onLabel: translator.get("On"), offLabel: translator.get("Off") });
      $("#stdinOnce").kendoMobileSwitch({ onLabel: translator.get("On"), offLabel: translator.get("Off") });
      $("#argsEscaped").kendoMobileSwitch({ onLabel: translator.get("On"), offLabel: translator.get("Off") });
      $("#networkdisabled").kendoMobileSwitch({ onLabel: translator.get("On"), offLabel: translator.get("Off") });

      $("#containerCreatePanelBarContent").kendoPanelBar({});





      $("#containerListAndDetailsGridView").kendoGrid({
        dataSource: new kendo.data.DataSource({
          transport: {
            read: function(options) {
              $.ajax({
                type: "GET",
                url: "http://panel.localhost:8888/restContainerList",
                contentType: "application/json; charset=utf-8",
                dataType: 'json',
                //data: JSON.stringify({key: "value"}),
                success: function(data) {
                  var newData = [];
                  for( var i in data.Objects ){
                    i = parseInt(i);
                    newData.push({
                      id: data.Objects[i].Id,
                      name: data.Objects[i].Names[0],
                      image: data.Objects[i].Image,
                      createdYear: new Date( data.Objects[i].Created * 1000 ),
                      createdHour: new Date( data.Objects[i].Created * 1000 ),
                      version: data.Objects[i].Labels.VERSION,
                      state: data.Objects[i].State,
                      status: data.Objects[i].Status
                    });
                  }

                  options.success(newData);
                }
              });
            }
          },
          pageSize: 25,
        }),
        //height: 500,
        navigatable: true,
        filterable: true,
        sortable: true,
        pageable: true,
        reorderable: true,
        resizable: true,
        columns: [
          {
            field: "name",
            width: 240,
            title: translator.get("Name")
          },
          {
            field: "image",
            width: 120,
            title: translator.get("Image")
          },
          {
            field: "createdYear",
            width: 80,
            title: translator.get("Created Day"),
            template: '#= kendo.toString(createdYear,"dd/MM/yyyy") #'

          },
          {
            field: "createdHour",
            width: 60,
            title: translator.get("Created Hour"),
            template: '#= kendo.toString(createdHour,"HH:mm") #'

          },
          {
            field: "version",
            width: 120,
            title: translator.get("Version")
          },
          {
            field: "state",
            width: 120,
            title: translator.get("State")
          },
          {
            command: {
              text: translator.get("View Details"),
              click: showDetails
            },
            title: " ",
            width: "180px"
          }
        ]
      });

      setInterval(function(){
        $.ajax({
          type: "GET",
          url: "http://panel.localhost:8888/restContainerList",
          contentType: "application/json; charset=utf-8",
          dataType: 'json',
          //data: JSON.stringify({key: "value"}),
          success: function(data) {
            let lastContainerStatusNewValue = {};

            for( let i in data.Objects ){
              i = parseInt(i);
              if( lastContainerStatusNewValue[data.Objects[i].State] === undefined){
                lastContainerStatusNewValue[data.Objects[i].State] = 1;
              }
              else {
                lastContainerStatusNewValue[data.Objects[i].State] += 1;
              }
            }

            let pass = true;

            try {
              for (let i in lastContainerStatusNewValue) {
                if (lastContainerStatusNewValue[i] !== lastContainerStatusOldValue[i]) {
                  pass = false;
                  break;
                }
              }

              for (let i in lastContainerStatusOldValue) {
                if (lastContainerStatusNewValue[i] !== lastContainerStatusOldValue[i]) {
                  pass = false;
                  break;
                }
              }
            }
            catch (e) {
              pass = false;
            }

            if( pass === true ){
              return;
            }

            lastContainerStatusOldValue = lastContainerStatusNewValue;

            let newData = [];
            for( let i in data.Objects ){
              i = parseInt(i);
              newData.push({
                id: data.Objects[i].Id,
                name: data.Objects[i].Names[0],
                image: data.Objects[i].Image,
                createdYear: new Date( data.Objects[i].Created * 1000 ),
                createdHour: new Date( data.Objects[i].Created * 1000 ),
                version: data.Objects[i].Labels.VERSION,
                state: data.Objects[i].State,
                status: data.Objects[i].Status
              });
            }

            $("#containerListAndDetailsGridView").data("kendoGrid").dataSource.read();
          }
        });

      }, 2000);

      windowContainerDetails = $("#containerDetailsWindowView").kendoWindow({
        title: translator.get("Container Details"),
        data: {id: ""},
        modal: true,
        visible: false,
        resizable: false,
        width: 700,
        height: 400,
        close: function(){
          clearInterval( containerStatisticsSetIntervalId );
        },
        open: function(){
          console.log("window id:", this.options.data.id);
          containerStatisticsSetIntervalId = setInterval(getContainerStatistics, 1000, this.options.data.id);
          translator = $("#containerDetailsWindowView").translate({lang: globalConfig.language, t: dict["CreateAContainer"]});
        }
      }).data("kendoWindow");

      detailsTemplate = kendo.template($("#containerDetailsTemplate").html());

      function showDetails(e) {
        e.preventDefault();

        let url = "";
        let dataItem = this.dataItem($(e.currentTarget).closest("tr"));
        windowContainerDetails.options.data.id = dataItem.id;
        windowContainerDetails.content(detailsTemplate(dataItem));
        windowContainerDetails.center().open();

        let popupNotification = $("#popupNotification").kendoNotification({
          stacking: "down",
          templates: [{
            type: "success",
            template: $("#successTemplate").html()
          }]

        }).data("kendoNotification");

        $("#containerActions").kendoButtonGroup({
          select: function (e) {
            let windowContainerDetails = $("#containerDetailsWindowView").data("kendoWindow");

            //windowContainerDetails.close();

            switch( e.indices[0] ){
              case 0:
                $.ajax({
                  type: "GET",
                  url: "http://panel.localhost:8888/containerLog/" + dataItem.id,
                  contentType: "application/json; charset=utf-8",
                  dataType: 'json',
                  success: function(data){
                    if( data.Objects.length === 0 ){
                      $("#dialog").kendoDialog({
                        modal: true,
                        visible: true,
                        title: "Container error",
                        content: "No data to show",
                        width: 800,
                        actions: [{
                          text: "OK",
                          primary: true
                        }]
                      });
                      return
                    }

                    $("#dialog").kendoDialog({
                      modal: true,
                      visible: true,
                      title: "Container Log",
                      content: "<pre class='containerLog'>" + unicodeToChar( data.Objects[0] ) + "</pre>",
                      width: 800,
                      actions: [{
                        text: "OK",
                        primary: true
                      }]
                    });
                  },
                  error: function(data){
                    $("#dialog").kendoDialog({
                      modal: true,
                      visible: true,
                      title: "Container error",
                      content: data.responseJSON.Meta.Error,
                      width: 800,
                      actions: [{
                        text: "OK",
                        primary: true
                      }]
                    });
                  }
                });
                return;

              case 1:
                url = "http://panel.localhost:8888/restContainerStart/" + dataItem.id;
                break;

              case 2:
                url = "http://panel.localhost:8888/restContainerStop/" + dataItem.id;
                break;

              case 3:
                url = "http://panel.localhost:8888/restContainerRemove/" + dataItem.id;
                break;

              case 4:
                url = "http://panel.localhost:8888/restContainerKill/" + dataItem.id;
                break;
            }

            $.ajax({
              type: "GET",
              url: url,
              contentType: "application/json; charset=utf-8",
              dataType: 'json',
              success: function(data){
                popupNotification.show({ message: "Command executed successfully" }, "success");
              },
              error: function(data){
                $("#dialog").kendoDialog({
                  modal: true,
                  visible: true,
                  title: "Container error",
                  content: data.responseJSON.Meta.Error,
                  width: 800,
                  actions: [{
                    text: "OK",
                    primary: true
                  }]
                });
              }
            });
          },
          index: -1
        });
      }

      $(document.body).keydown(function(e) {
        if (e.altKey && e.keyCode === 87) {
          $("#containerListAndDetailsGridView").data("kendoGrid").table.focus();
        }
      });


    });

    function unicodeToChar(text) {
      return text.replace(/\\u[\dA-F]{4}/gi,
          function (match) {
            return String.fromCharCode(parseInt(match.replace(/\\u/g, ''), 16));
          });
    }
    function adjustByteUnit(nFlt){
      if(nFlt >= 1024 * 1024 * 1024 * 1024){
        return adjustDecimalPoint(nFlt / (1024 * 1024 * 1024 * 1024)) + " TB";
      }
      if(nFlt >= 1024 * 1024 * 1024){
        return adjustDecimalPoint(nFlt / (1024 * 1024 * 1024)) + " GB";
      }
      if(nFlt >= 1024 * 1024){
        return adjustDecimalPoint(nFlt / (1024 * 1024)) + " MB";
      }
      if(nFlt >= 1024){
        return adjustDecimalPoint(nFlt / (1024)) + " KB";
      }
      return adjustDecimalPoint(nFlt)  + " B";
    }
    function adjustDecimalPoint(nStr){
      nStr += '';
      x = nStr.split('.');
      x1 = x[0];
      x2 = x.length > 1 ? '.' + x[1].substr(0,1) : '';
      return x1;
      //return x1 + x2;
    }











    function getContainerStatistics(id){
      if( containerStatisticsWaitingData === true ){
        return
      }

      containerStatisticsWaitingData = true;

      $.ajax({
        type: "GET",
        url: "http://panel.localhost:8888/restContainerStatsLog/" + id,
        contentType: "application/json; charset=utf-8",
        dataType: 'json',
        success: function(data){
          containerStatisticsWaitingData = false;

          if( data.Meta.Success !== true ){
            // fixme: mensagem de erro
            return;
          }

          containerStatisticMemPercentData       = [];
          containerStatisticCpuPercentData       = [];
          containerStatisticBlkReadData          = [];
          containerStatisticBlkWriteData         = [];
          containerStatisticNetRxData            = [];
          containerStatisticNetTxData            = [];
          containerStatisticPidsStatsCurrentData = [];

          for( let i = 0; i !== data.Objects.length; i += 1){
            containerStatisticMemPercentData.push( adjustDecimalPoint( data.Objects[ i ].MemPercent * 100 ) );
            containerStatisticCpuPercentData.push( adjustDecimalPoint( data.Objects[ i ].CpuPercent * 100 ) );
            containerStatisticBlkReadData.push( adjustDecimalPoint( data.Objects[ i ].BlkRead / 1024 ) );
            containerStatisticBlkWriteData.push( adjustDecimalPoint( data.Objects[ i ].BlkWrite / 1024 ) );
            containerStatisticNetRxData.push( adjustDecimalPoint( data.Objects[ i ].NetRx / 1024 ) );
            containerStatisticNetTxData.push( adjustDecimalPoint( data.Objects[ i ].NetTx / 1024 ) );
            containerStatisticPidsStatsCurrentData.push( adjustDecimalPoint( data.Objects[ i ].PidsStatsCurrent ) );
          }

          $("#memPercentValue").html( containerStatisticMemPercentData[ containerStatisticMemPercentData.length - 1 ] + "%" );
          $("#cpuPercentValue").html( containerStatisticCpuPercentData[ containerStatisticCpuPercentData.length - 1 ] + "%" );
          $("#blkReadValue").html( adjustByteUnit( containerStatisticBlkReadData[ containerStatisticBlkReadData.length - 1 ] ) );
          $("#blkWriteValue").html( adjustByteUnit( containerStatisticBlkWriteData[ containerStatisticBlkWriteData.length - 1 ] ) );
          $("#netRxValue").html( adjustByteUnit( containerStatisticNetRxData[ containerStatisticNetRxData.length - 1 ] ) );
          $("#netTxValue").html( adjustByteUnit( containerStatisticNetTxData[ containerStatisticNetTxData.length - 1 ] ) );
          $("#pidsStatsCurrentValue").html( containerStatisticPidsStatsCurrentData[ containerStatisticPidsStatsCurrentData.length - 1 ] );

          $("#memPercent").kendoSparkline({
            type: "area",
            data: containerStatisticMemPercentData,
            tooltip: {
              format: "{0}%"
            },
            seriesColors: ["#558B9B"],
          });

          $("#cpuPercent").kendoSparkline({
            type: "area",
            data: containerStatisticCpuPercentData,
            tooltip: {
              format: "{0}%"
            },
            seriesColors: ["#558B9B"],
          });

          $("#blkRead").kendoSparkline({
            type: "area",
            data: containerStatisticBlkReadData,
            tooltip: {
              format: "{0}B"
            },
            seriesColors: ["#558B9B"],
          });

          $("#blkWrite").kendoSparkline({
            type: "area",
            data: containerStatisticBlkWriteData,
            tooltip: {
              format: "{0}B"
            },
            seriesColors: ["#558B9B"],
          });

          $("#netRx").kendoSparkline({
            type: "area",
            data: containerStatisticNetRxData,
            tooltip: {
              format: "{0}B"
            },
            seriesColors: ["#558B9B"],
          });

          $("#netTx").kendoSparkline({
            type: "area",
            data: containerStatisticNetTxData,
            tooltip: {
              format: "{0}B"
            },
            seriesColors: ["#558B9B"],
          });

          $("#pidsStatsCurrent").kendoSparkline({
            type: "area",
            data: containerStatisticPidsStatsCurrentData,
            tooltip: {
              format: "{0}"
            },
            seriesColors: ["#558B9B"],
          });
        }
      });
    }
  </script>























  <script id="successTemplate" type="text/x-kendo-template">
    <div class="success">
      <img src="mvc/view/notifications/images/success-icon.png" />
      <h3>#= message #</h3>
    </div>
  </script>






  <script type="text/x-kendo-template" id="containerDetailsTemplate">
    <h2>Name: #= name #</h2>
    <em>Image: #= image #</em>
    <table class="containerData">
      <tr>
        <td class="col1" data-trn-key="Men:">Mem:</td>
        <td class="col2"><span id="memPercent"></span></td>
        <td class="col3" id="memPercentValue">0%</td>
      </tr>
      <tr>
        <td class="col1" data-trn-key="CPU:">CPU:</td>
        <td class="col2"><span id="cpuPercent"></span></td>
        <td class="col3" id="cpuPercentValue">0%</td>
      </tr>
      <tr>
        <td class="col1" data-trn-key="Block read:">Block read:</td>
        <td class="col2"><span id="blkRead"></span></td>
        <td class="col3" id="blkReadValue">0kB</td>
      </tr>
      <tr>
        <td class="col1" data-trn-key="Block write:">Block write:</td>
        <td class="col2"><span id="blkWrite"></span></td>
        <td class="col3" id="blkWriteValue">0kB</td>
      </tr>
      <tr>
        <td class="col1" data-trn-key="Net rx:">Net rx:</td>
        <td class="col2"><span id="netRx"></span></td>
        <td class="col3" id="netRxValue">0kB</td>
      </tr>
      <tr>
        <td class="col1" data-trn-key="Net tx:">Net tx:</td>
        <td class="col2"><span id="netTx"></span></td>
        <td class="col3" id="netTxValue">0kB</td>
      </tr>
      <tr>
        <td class="col1" data-trn-key="Pids:">Pids:</td>
        <td class="col2"><span id="pidsStatsCurrent"></span></td>
        <td class="col3" id="pidsStatsCurrentValue">0</td>
      </tr>
    </table>

    <dl>
      <dt><span data-trn-key="Status:">Status:</span> <b>#= status #</b></dt>
      <dt><span data-trn-key="Created date:">Created date:</span> <b>#= kendo.toString(createdYear, "dd/MM/yyyy HH:mm") #</b></dt>
    </dl>
    <div id="containerActions">
      <span data-trn-key="View Log">View Log</span>
      <span data-trn-key="Start">Start</span>
      <span data-trn-key="Stop">Stop</span>
      <span data-trn-key="Remove">Remove</span>
      <span data-trn-key="Kill">Kill</span>
    </div>
  </script>
</div>
<span id="popupNotification"></span>
<div id="dialog"></div>
</body>
</html>